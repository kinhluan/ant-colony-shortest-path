<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√¥ T·∫£ Thu·∫≠t To√°n ACO - Demo ƒê∆°n Gi·∫£n</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .back-button {
            background-color: #2c3e50;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background-color: #34495e;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transform: translateY(-2px);
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .content-wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 968px) {
            .content-wrapper {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .card h3 {
            color: #764ba2;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .visualization-area {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        canvas {
            border: 2px solid #ddd;
            border-radius: 8px;
            background: white;
            max-width: 100%;
        }

        .controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .algorithm-steps {
            list-style: none;
            counter-reset: step-counter;
        }

        .algorithm-steps li {
            counter-increment: step-counter;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            border-radius: 5px;
            position: relative;
        }

        .algorithm-steps li::before {
            content: counter(step-counter);
            position: absolute;
            left: -35px;
            top: 15px;
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .formula {
            background: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
            text-align: center;
            overflow-x: auto;
        }

        .parameter-info {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .info-box {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .status-display {
            margin-top: 15px;
            padding: 15px;
            background: #e7f3ff;
            border-radius: 8px;
            border-left: 4px solid #0066cc;
        }

        .status-display strong {
            color: #0066cc;
        }

        .legend {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 30px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid #333;
        }

        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #d63384;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-button">
            <span>‚Üê</span>
            <span>Quay l·∫°i Trang ch·ªß</span>
        </a>

        <h1>üêú Thu·∫≠t To√°n T·ªëi ∆Øu ƒê√†n Ki·∫øn (ACO) - Demo ƒê∆°n Gi·∫£n</h1>

        <div class="content-wrapper">
            <!-- Left Column: Visualization -->
            <div class="card">
                <h2>Visualization - T√¨m ƒê∆∞·ªùng ƒêi Ng·∫Øn Nh·∫•t</h2>
                <div class="visualization-area">
                    <canvas id="graphCanvas" width="600" height="400"></canvas>
                    <div class="controls">
                        <button class="btn btn-primary" onclick="startSimulation()">‚ñ∂ Ch·∫°y Thu·∫≠t To√°n</button>
                        <button class="btn btn-secondary" onclick="stepSimulation()">‚èØ Ch·∫°y T·ª´ng B∆∞·ªõc</button>
                        <button class="btn btn-success" onclick="resetSimulation()">‚Üª Reset</button>
                    </div>
                    <div class="status-display" id="statusDisplay">
                        <strong>Tr·∫°ng th√°i:</strong> <span id="statusText">Ch∆∞a b·∫Øt ƒë·∫ßu</span><br>
                        <strong>L·∫ßn l·∫∑p:</strong> <span id="iterationText">0/50</span><br>
                        <strong>ƒê∆∞·ªùng ƒëi t·ªët nh·∫•t:</strong> <span id="bestPathText">-</span><br>
                        <strong>Chi ph√≠ t·ªët nh·∫•t:</strong> <span id="bestCostText">‚àû</span>
                    </div>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #28a745;"></div>
                            <span>N√∫t B·∫Øt ƒë·∫ßu</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #dc3545;"></div>
                            <span>N√∫t K·∫øt th√∫c</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #ffc107;"></div>
                            <span>N√∫t Trung gian</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #0066cc;"></div>
                            <span>ƒê∆∞·ªùng ƒëi t·ªët nh·∫•t</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Algorithm Explanation -->
            <div class="card">
                <h2>Gi·∫£i Th√≠ch Thu·∫≠t To√°n</h2>

                <h3>üìñ √ù T∆∞·ªüng C∆° B·∫£n</h3>
                <p>Thu·∫≠t to√°n ACO m√¥ ph·ªèng h√†nh vi t√¨m ƒë∆∞·ªùng c·ªßa ki·∫øn trong t·ª± nhi√™n:</p>
                <ul style="margin-left: 30px; margin-top: 10px; line-height: 1.8;">
                    <li>üêú Ki·∫øn th·∫£ <strong>pheromone</strong> (ch·∫•t m√πi) khi di chuy·ªÉn</li>
                    <li>üëÉ Ki·∫øn kh√°c ng·ª≠i th·∫•y pheromone v√† ∆∞u ti√™n ƒëi theo</li>
                    <li>‚ö° ƒê∆∞·ªùng ng·∫Øn h∆°n ‚Üí Pheromone t√≠ch l≈©y nhanh h∆°n</li>
                    <li>üéØ D·∫ßn d·∫ßn, ƒë√†n ki·∫øn t√¨m ra ƒë∆∞·ªùng ƒëi t·ªëi ∆∞u</li>
                </ul>

                <div class="info-box">
                    <strong>üí° V√≠ d·ª•:</strong> Trong demo n√†y, ch√∫ng ta t√¨m ƒë∆∞·ªùng ƒëi ng·∫Øn nh·∫•t t·ª´ n√∫t <strong style="color: #28a745;">A (xanh)</strong> ƒë·∫øn n√∫t <strong style="color: #dc3545;">E (ƒë·ªè)</strong> qua c√°c n√∫t trung gian.
                </div>

                <h3>üî¢ C√°c B∆∞·ªõc Thu·∫≠t To√°n</h3>
                <ol class="algorithm-steps" style="margin-left: 40px;">
                    <li>
                        <strong>Kh·ªüi t·∫°o</strong><br>
                        ƒê·∫∑t pheromone ban ƒë·∫ßu <code>œÑ = 1.0</code> cho t·∫•t c·∫£ c√°c c·∫°nh
                    </li>
                    <li>
                        <strong>X√¢y d·ª±ng l·ªùi gi·∫£i</strong><br>
                        M·ªói ki·∫øn x√¢y d·ª±ng m·ªôt ƒë∆∞·ªùng ƒëi t·ª´ A ‚Üí E b·∫±ng c√°ch ch·ªçn n√∫t k·∫ø ti·∫øp theo x√°c su·∫•t:
                        <div class="formula">
                            P(i,j) = [œÑ<sub>ij</sub><sup>Œ±</sup> √ó Œ∑<sub>ij</sub><sup>Œ≤</sup>] / Œ£[œÑ<sup>Œ±</sup> √ó Œ∑<sup>Œ≤</sup>]
                        </div>
                        Trong ƒë√≥:
                        <ul style="margin-left: 20px; margin-top: 8px;">
                            <li><code>œÑ<sub>ij</sub></code>: L∆∞·ª£ng pheromone tr√™n c·∫°nh (i,j)</li>
                            <li><code>Œ∑<sub>ij</sub></code>: ƒê·ªô t·ªët c·ªßa c·∫°nh = 1/kho·∫£ng_c√°ch</li>
                            <li><code>Œ±</code>: Tr·ªçng s·ªë pheromone (m·∫∑c ƒë·ªãnh = 1.0)</li>
                            <li><code>Œ≤</code>: Tr·ªçng s·ªë heuristic (m·∫∑c ƒë·ªãnh = 2.0)</li>
                        </ul>
                    </li>
                    <li>
                        <strong>C·∫≠p nh·∫≠t Pheromone</strong><br>
                        Sau khi t·∫•t c·∫£ ki·∫øn ho√†n th√†nh:
                        <div class="formula">
                            œÑ<sub>ij</sub> ‚Üê (1-œÅ) √ó œÑ<sub>ij</sub> + Œ£ ŒîœÑ<sub>k</sub>
                        </div>
                        Trong ƒë√≥:
                        <ul style="margin-left: 20px; margin-top: 8px;">
                            <li><code>œÅ</code>: T·ªëc ƒë·ªô bay h∆°i pheromone (0.5)</li>
                            <li><code>ŒîœÑ<sub>k</sub> = Q/L<sub>k</sub></code>: L∆∞·ª£ng pheromone ki·∫øn k th√™m v√†o</li>
                            <li><code>Q</code>: H·∫±ng s·ªë (100)</li>
                            <li><code>L<sub>k</sub></code>: ƒê·ªô d√†i ƒë∆∞·ªùng ƒëi c·ªßa ki·∫øn k</li>
                        </ul>
                    </li>
                    <li>
                        <strong>L·∫∑p l·∫°i</strong><br>
                        Quay l·∫°i b∆∞·ªõc 2 cho ƒë·∫øn khi ƒë·∫°t s·ªë v√≤ng l·∫∑p t·ªëi ƒëa (50 v√≤ng)
                    </li>
                </ol>

                <h3>‚öôÔ∏è Tham S·ªë Quan Tr·ªçng</h3>
                <div class="parameter-info">
                    <strong>Trong demo n√†y:</strong><br>
                    ‚Ä¢ S·ªë ki·∫øn: <code>10</code><br>
                    ‚Ä¢ S·ªë v√≤ng l·∫∑p: <code>50</code><br>
                    ‚Ä¢ Œ± (alpha): <code>1.0</code> - ·∫¢nh h∆∞·ªüng c·ªßa pheromone<br>
                    ‚Ä¢ Œ≤ (beta): <code>2.0</code> - ·∫¢nh h∆∞·ªüng c·ªßa kho·∫£ng c√°ch<br>
                    ‚Ä¢ œÅ (rho): <code>0.5</code> - T·ªëc ƒë·ªô bay h∆°i pheromone
                </div>

                <h3>üéØ K·∫øt Qu·∫£ Mong ƒê·ª£i</h3>
                <p>V·ªõi ƒë·ªì th·ªã 5 n√∫t trong demo, thu·∫≠t to√°n s·∫Ω t√¨m ra ƒë∆∞·ªùng ƒëi ng·∫Øn nh·∫•t t·ª´ A ‚Üí E. Th∆∞·ªùng k·∫øt qu·∫£ l√†:</p>
                <ul style="margin-left: 30px; margin-top: 10px; line-height: 1.8;">
                    <li>‚úÖ <strong>ƒê∆∞·ªùng ƒëi t·ªëi ∆∞u:</strong> A ‚Üí B ‚Üí E (chi ph√≠: 7)</li>
                    <li>üìä H·ªôi t·ª• sau kho·∫£ng 20-30 v√≤ng l·∫∑p</li>
                    <li>üîç Pheromone t·∫≠p trung v√†o ƒë∆∞·ªùng ƒëi t·ªëi ∆∞u</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Graph setup
        const canvas = document.getElementById('graphCanvas');
        const ctx = canvas.getContext('2d');

        // Graph structure - 5 nodes simple graph
        const nodes = [
            { id: 'A', x: 100, y: 200, color: '#28a745' },  // Start - green
            { id: 'B', x: 250, y: 100, color: '#ffc107' },  // Intermediate - yellow
            { id: 'C', x: 250, y: 300, color: '#ffc107' },  // Intermediate - yellow
            { id: 'D', x: 400, y: 200, color: '#ffc107' },  // Intermediate - yellow
            { id: 'E', x: 550, y: 200, color: '#dc3545' }   // End - red
        ];

        const edges = [
            { from: 'A', to: 'B', distance: 5, pheromone: 1.0 },
            { from: 'A', to: 'C', distance: 8, pheromone: 1.0 },
            { from: 'B', to: 'D', distance: 6, pheromone: 1.0 },
            { from: 'B', to: 'E', distance: 2, pheromone: 1.0 },
            { from: 'C', to: 'D', distance: 4, pheromone: 1.0 },
            { from: 'D', to: 'E', distance: 3, pheromone: 1.0 }
        ];

        // Algorithm parameters
        const numAnts = 10;
        const numIterations = 50;
        const alpha = 1.0;  // pheromone importance
        const beta = 2.0;   // distance importance
        const evaporation = 0.5;
        const Q = 100;

        // State
        let currentIteration = 0;
        let bestPath = null;
        let bestCost = Infinity;
        let isRunning = false;
        let animationId = null;

        // Draw functions
        function drawGraph() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw edges with pheromone intensity
            edges.forEach(edge => {
                const fromNode = nodes.find(n => n.id === edge.from);
                const toNode = nodes.find(n => n.id === edge.to);

                // Line thickness based on pheromone
                const thickness = Math.min(1 + edge.pheromone * 2, 10);
                const opacity = Math.min(0.3 + edge.pheromone * 0.1, 1);

                ctx.beginPath();
                ctx.moveTo(fromNode.x, fromNode.y);
                ctx.lineTo(toNode.x, toNode.y);
                ctx.strokeStyle = `rgba(102, 126, 234, ${opacity})`;
                ctx.lineWidth = thickness;
                ctx.stroke();

                // Draw distance label
                const midX = (fromNode.x + toNode.x) / 2;
                const midY = (fromNode.y + toNode.y) / 2;
                ctx.fillStyle = '#333';
                ctx.font = 'bold 12px Arial';
                ctx.fillText(edge.distance.toString(), midX - 5, midY - 5);
            });

            // Highlight best path if found
            if (bestPath && bestPath.length > 1) {
                for (let i = 0; i < bestPath.length - 1; i++) {
                    const fromNode = nodes.find(n => n.id === bestPath[i]);
                    const toNode = nodes.find(n => n.id === bestPath[i + 1]);

                    ctx.beginPath();
                    ctx.moveTo(fromNode.x, fromNode.y);
                    ctx.lineTo(toNode.x, toNode.y);
                    ctx.strokeStyle = '#0066cc';
                    ctx.lineWidth = 6;
                    ctx.stroke();
                }
            }

            // Draw nodes
            nodes.forEach(node => {
                ctx.beginPath();
                ctx.arc(node.x, node.y, 25, 0, 2 * Math.PI);
                ctx.fillStyle = node.color;
                ctx.fill();
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 3;
                ctx.stroke();

                ctx.fillStyle = 'white';
                ctx.font = 'bold 20px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(node.id, node.x, node.y);
            });
        }

        // ACO algorithm
        function constructAntSolution() {
            const path = ['A'];
            const visited = new Set(['A']);
            let current = 'A';
            let totalCost = 0;

            while (current !== 'E') {
                // Get possible next nodes
                const possibleEdges = edges.filter(e =>
                    (e.from === current && !visited.has(e.to)) ||
                    (e.to === current && !visited.has(e.from))
                );

                if (possibleEdges.length === 0) {
                    return null; // Dead end
                }

                // Calculate probabilities
                const probabilities = possibleEdges.map(edge => {
                    const nextNode = edge.from === current ? edge.to : edge.from;
                    const tau = Math.pow(edge.pheromone, alpha);
                    const eta = Math.pow(1 / edge.distance, beta);
                    return { edge, nextNode, value: tau * eta };
                });

                const sum = probabilities.reduce((acc, p) => acc + p.value, 0);
                const normalized = probabilities.map(p => ({ ...p, prob: p.value / sum }));

                // Roulette wheel selection
                const rand = Math.random();
                let cumulative = 0;
                let selected = null;

                for (const item of normalized) {
                    cumulative += item.prob;
                    if (rand <= cumulative) {
                        selected = item;
                        break;
                    }
                }

                if (!selected) selected = normalized[normalized.length - 1];

                current = selected.nextNode;
                path.push(current);
                visited.add(current);
                totalCost += selected.edge.distance;
            }

            return { path, cost: totalCost };
        }

        function updatePheromones(antSolutions) {
            // Evaporation
            edges.forEach(edge => {
                edge.pheromone *= (1 - evaporation);
            });

            // Deposit pheromone
            antSolutions.forEach(solution => {
                if (!solution) return;

                const delta = Q / solution.cost;

                for (let i = 0; i < solution.path.length - 1; i++) {
                    const from = solution.path[i];
                    const to = solution.path[i + 1];

                    const edge = edges.find(e =>
                        (e.from === from && e.to === to) ||
                        (e.from === to && e.to === from)
                    );

                    if (edge) {
                        edge.pheromone += delta;
                    }
                }
            });
        }

        function runIteration() {
            const antSolutions = [];

            // Each ant constructs a solution
            for (let i = 0; i < numAnts; i++) {
                const solution = constructAntSolution();
                antSolutions.push(solution);

                // Update best solution
                if (solution && solution.cost < bestCost) {
                    bestCost = solution.cost;
                    bestPath = solution.path;
                }
            }

            // Update pheromones
            updatePheromones(antSolutions);

            currentIteration++;
            updateStatus();
            drawGraph();

            return currentIteration < numIterations;
        }

        function updateStatus() {
            document.getElementById('statusText').textContent = isRunning ? 'ƒêang ch·∫°y...' : 'ƒê√£ d·ª´ng';
            document.getElementById('iterationText').textContent = `${currentIteration}/${numIterations}`;
            document.getElementById('bestPathText').textContent = bestPath ? bestPath.join(' ‚Üí ') : '-';
            document.getElementById('bestCostText').textContent = bestCost === Infinity ? '‚àû' : bestCost.toFixed(2);
        }

        function startSimulation() {
            if (isRunning) return;

            isRunning = true;
            updateStatus();

            function animate() {
                const shouldContinue = runIteration();

                if (shouldContinue && isRunning) {
                    animationId = setTimeout(animate, 100);
                } else {
                    isRunning = false;
                    updateStatus();
                    document.getElementById('statusText').textContent = 'Ho√†n th√†nh!';
                }
            }

            animate();
        }

        function stepSimulation() {
            if (currentIteration >= numIterations) {
                resetSimulation();
            }
            runIteration();
        }

        function resetSimulation() {
            if (animationId) {
                clearTimeout(animationId);
            }

            isRunning = false;
            currentIteration = 0;
            bestPath = null;
            bestCost = Infinity;

            // Reset pheromones
            edges.forEach(edge => {
                edge.pheromone = 1.0;
            });

            updateStatus();
            drawGraph();
            document.getElementById('statusText').textContent = 'ƒê√£ reset';
        }

        // Initial draw
        drawGraph();
        updateStatus();
    </script>
</body>
</html>
